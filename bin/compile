#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

indent() {
  sed -u 's/^/       /'
}

BUILD_DIR=$1
SPHINX_DIR=$BUILD_DIR/vendor/sphinx
BIN_DIR=$SPHINX_DIR/bin
PROFILED_DIR=$BUILD_DIR/.profile.d
APP_BIN_DIR=/app/vendor/sphinx/bin
URL="http://sphinxsearch.com/files/sphinx-3.0.2-2592786-linux-amd64.tar.gz"

echo "-----> Installing Sphinx"
mkdir -p $BIN_DIR

echo Vendoring $URL | indent
curl -s $URL | tar -xz -C $SPHINX_DIR --strip-components=1

echo Setting PATH | indent
mkdir -p $PROFILED_DIR
echo PATH=\$PATH:$APP_BIN_DIR > $PROFILED_DIR/sphinx.sh
